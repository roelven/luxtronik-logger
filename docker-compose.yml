version: "3.8"

networks:
  luxtronik-network:
    driver: bridge

services:
  luxtronik-logger:
    build: .
    container_name: luxtronik-logger
    ports:
      - "8889:8889" # Heat pump communication
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    environment:
      - HOST=${HOST:-192.168.20.180}
      - PORT=${PORT:-8889}
      - INTERVAL_SEC=${INTERVAL_SEC:-30}
      - CSV_TIME=${CSV_TIME:-07:00}
      - CACHE_PATH=/app/data/cache.db
      - OUTPUT_DIRS_DAILY=/app/data/reports/daily
      - OUTPUT_DIRS_WEEKLY=/app/data/reports/weekly
      - READABLE_HEADERS=${READABLE_HEADERS:-false}
    env_file:
      - .env
    command: python main.py --mode service
    restart: unless-stopped
    networks:
      - luxtronik-network

  luxtronik-web:
    build: .
    container_name: luxtronik-web
    ports:
      - "8000:8000" # Web interface
    volumes:
      - ./data:/app/data
    environment:
      - CACHE_PATH=/app/data/cache.db
      - OUTPUT_DIRS_DAILY=/app/data/reports/daily
      - OUTPUT_DIRS_WEEKLY=/app/data/reports/weekly
    command: python main.py --mode web
    restart: unless-stopped
    depends_on:
      - luxtronik-logger
    networks:
      - luxtronik-network
